{% extends 'accounts/base.html' %}

{% block title %}{{ current_user.username }}'s Profile - StreamAI{% endblock %}
{% block description %}Manage your StreamAI profile, preferences, and notifications{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-gray-800 shadow rounded-lg overflow-hidden">
        <!-- Profile header -->
        <div class="bg-gradient-to-r from-purple-900 to-indigo-800 p-6">
            <div class="flex flex-col md:flex-row items-start md:items-center">
                <div class="flex-shrink-0 mb-4 md:mb-0 md:mr-6">
                    <div class="w-24 h-24 bg-gray-700 rounded-full flex items-center justify-center text-4xl font-bold text-white">
                        {{ current_user.username[0].upper() }}
                    </div>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">{{ current_user.username }}</h1>
                    <p class="text-indigo-200">Member since {{ current_user.created_at.strftime('%B %d, %Y') }}</p>
                </div>
            </div>
        </div>
        
        <!-- Profile tabs -->
        <div class="border-b border-gray-700">
            <nav class="flex -mb-px">
                <a href="#account" class="text-white border-b-2 border-primary-500 py-4 px-6 text-center font-medium cursor-pointer">
                    Account
                </a>
                <a href="#watchlist" class="text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-500 py-4 px-6 text-center font-medium cursor-pointer">
                    Watchlist
                </a>
                <a href="#liked" class="text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-500 py-4 px-6 text-center font-medium cursor-pointer">
                    Liked
                </a>
                <a href="#activity" class="text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-500 py-4 px-6 text-center font-medium cursor-pointer">
                    Activity
                </a>
            </nav>
        </div>
        
        <!-- Account section -->
        <div id="account-section" class="p-6">
            <h2 class="text-xl font-bold mb-4">Account Settings</h2>
            
            <div class="space-y-6">
                <!-- Profile Information -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Profile Information</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Username</label>
                            <div class="mt-1">
                                <input type="text" value="{{ current_user.username }}" readonly
                                       class="w-full px-4 py-2 bg-gray-600 border border-gray-600 rounded-md text-white cursor-not-allowed">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Email</label>
                            <div class="mt-1">
                                <input type="email" value="{{ current_user.email }}" readonly
                                       class="w-full px-4 py-2 bg-gray-600 border border-gray-600 rounded-md text-white cursor-not-allowed">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification Settings -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Notification Settings</h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="email_notifications" name="email_notifications" type="checkbox" 
                                       {% if current_user.email_notifications %}checked{% endif %}
                                       class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-500 rounded bg-gray-600">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="email_notifications" class="font-medium text-white">Email notifications</label>
                                <p class="text-gray-400">Receive email notifications when new episodes or movies are released.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button id="save-notifications" class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md shadow focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                            Save Changes
                        </button>
                    </div>
                </div>
                
                <!-- Change Password -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Change Password</h3>
                    
                    <form class="space-y-4">
                        <div>
                            <label for="current_password" class="block text-sm font-medium text-gray-300">Current Password</label>
                            <div class="mt-1 relative">
                                <input type="password" id="current_password" name="current_password" required 
                                       class="w-full px-4 py-2 bg-gray-600 border border-gray-600 rounded-md text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500">
                                <button type="button" class="password-toggle absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label for="new_password" class="block text-sm font-medium text-gray-300">New Password</label>
                            <div class="mt-1 relative">
                                <input type="password" id="new_password" name="new_password" required 
                                       class="w-full px-4 py-2 bg-gray-600 border border-gray-600 rounded-md text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500">
                                <button type="button" class="password-toggle absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label for="confirm_new_password" class="block text-sm font-medium text-gray-300">Confirm New Password</label>
                            <div class="mt-1 relative">
                                <input type="password" id="confirm_new_password" name="confirm_new_password" required 
                                       class="w-full px-4 py-2 bg-gray-600 border border-gray-600 rounded-md text-white focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500">
                                <button type="button" class="password-toggle absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md shadow focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Watchlist section (hidden by default) -->
        <div id="watchlist-section" class="p-6 hidden">
            <h2 class="text-xl font-bold mb-4">Your Watchlist</h2>
            
            <div id="watchlist-container" class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                <div class="flex justify-center col-span-full py-12">
                    <div class="loader"></div>
                </div>
            </div>
            
            <div id="empty-watchlist" class="hidden text-center py-12">
                <svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <p class="text-gray-400">Your watchlist is empty</p>
                <a href="/browse" class="mt-4 inline-block px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md">Browse content</a>
            </div>
        </div>
        
        <!-- Liked section (hidden by default) -->
        <div id="liked-section" class="p-6 hidden">
            <h2 class="text-xl font-bold mb-4">Content You've Liked</h2>
            
            <div id="liked-container" class="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                <div class="flex justify-center col-span-full py-12">
                    <div class="loader"></div>
                </div>
            </div>
            
            <div id="empty-liked" class="hidden text-center py-12">
                <svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                <p class="text-gray-400">You haven't liked anything yet</p>
                <a href="/browse" class="mt-4 inline-block px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md">Browse content</a>
            </div>
        </div>
        
        <!-- Activity section (hidden by default) -->
        <div id="activity-section" class="p-6 hidden">
            <h2 class="text-xl font-bold mb-4">Recent Activity</h2>
            
            <div id="activity-container">
                <div class="space-y-4">
                    <div class="flex justify-center py-12">
                        <div class="loader"></div>
                    </div>
                </div>
            </div>
            
            <div id="empty-activity" class="hidden text-center py-12">
                <svg class="w-16 h-16 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-gray-400">No recent activity</p>
                <a href="/browse" class="mt-4 inline-block px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md">Start exploring</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab navigation
        const tabs = document.querySelectorAll('.border-b a');
        const sections = {
            'account': document.getElementById('account-section'),
            'watchlist': document.getElementById('watchlist-section'),
            'liked': document.getElementById('liked-section'),
            'activity': document.getElementById('activity-section')
        };
        
        // Handle tab clicks
        tabs.forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get the hash without the # prefix
                const tabId = this.getAttribute('href').substring(1);
                
                // Update active tab styles
                tabs.forEach(t => {
                    t.classList.remove('text-white', 'border-primary-500');
                    t.classList.add('text-gray-400', 'border-transparent');
                });
                this.classList.add('text-white', 'border-primary-500');
                this.classList.remove('text-gray-400', 'border-transparent');
                
                // Hide all sections and show the selected one
                Object.values(sections).forEach(section => {
                    section.classList.add('hidden');
                });
                
                if (sections[tabId]) {
                    sections[tabId].classList.remove('hidden');
                    
                    // Load data for the selected tab if needed
                    if (tabId === 'watchlist' && !sections[tabId].dataset.loaded) {
                        loadWatchlist();
                        sections[tabId].dataset.loaded = 'true';
                    } else if (tabId === 'liked' && !sections[tabId].dataset.loaded) {
                        loadLiked();
                        sections[tabId].dataset.loaded = 'true';
                    } else if (tabId === 'activity' && !sections[tabId].dataset.loaded) {
                        loadActivity();
                        sections[tabId].dataset.loaded = 'true';
                    }
                }
            });
        });
        
        // Save notification settings
        const saveNotificationsBtn = document.getElementById('save-notifications');
        if (saveNotificationsBtn) {
            saveNotificationsBtn.addEventListener('click', async function() {
                const emailNotifications = document.getElementById('email_notifications').checked;
                
                // Show saving indicator
                this.innerHTML = 'Saving...';
                this.disabled = true;
                
                try {
                    // In a real app, this would be an API call to update settings
                    // For now, just simulate a delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'mt-4 text-green-500 text-sm';
                    successMessage.textContent = 'Notification settings saved successfully!';
                    
                    this.parentNode.appendChild(successMessage);
                    
                    // Remove success message after 3 seconds
                    setTimeout(() => {
                        successMessage.remove();
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error saving notification settings:', error);
                    
                    // Show error message
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'mt-4 text-red-500 text-sm';
                    errorMessage.textContent = 'Failed to save notification settings. Please try again.';
                    
                    this.parentNode.appendChild(errorMessage);
                    
                    // Remove error message after 3 seconds
                    setTimeout(() => {
                        errorMessage.remove();
                    }, 3000);
                    
                } finally {
                    // Reset button state
                    this.innerHTML = 'Save Changes';
                    this.disabled = false;
                }
            });
        }
        
        // Load watchlist data
        function loadWatchlist() {
            const container = document.getElementById('watchlist-container');
            const emptyState = document.getElementById('empty-watchlist');
            
            // Simulate loading delay
            setTimeout(() => {
                // For demonstration purposes, show empty state
                container.innerHTML = '';
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                
                // In a real app, this would fetch watchlist data from the server
                // and render watchlist items in the container
            }, 1500);
        }
        
        // Load liked content data
        function loadLiked() {
            const container = document.getElementById('liked-container');
            const emptyState = document.getElementById('empty-liked');
            
            // Simulate loading delay
            setTimeout(() => {
                // For demonstration purposes, show empty state
                container.innerHTML = '';
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                
                // In a real app, this would fetch liked content data from the server
                // and render items in the container
            }, 1500);
        }
        
        // Load activity data
        function loadActivity() {
            const container = document.getElementById('activity-container');
            const emptyState = document.getElementById('empty-activity');
            
            // Simulate loading delay
            setTimeout(() => {
                // For demonstration purposes, show empty state
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                
                // In a real app, this would fetch activity data from the server
                // and render activity items in the container
            }, 1500);
        }
        
        // Handle tab in URL hash
        if (window.location.hash) {
            const hash = window.location.hash.substring(1);
            const tabElement = document.querySelector(`a[href="#${hash}"]`);
            if (tabElement && sections[hash]) {
                tabElement.click();
            }
        }
    });
</script>
{% endblock %}
